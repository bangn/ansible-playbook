---

- name: Create /etc/X11/xorg.conf.d directory if it does not exist
  file:
    path: "{{ item }}"
    state: directory
    owner: root
    mode: 0755
  with_items:
    - /etc/X11/xorg.conf.d

- name: Create /etc/X11/xorg.conf.d/70-synaptics.conf file if it is not exist
  file:
    path: "{{ item }}"
    state: touch
    owner: root
    mode: 0755
  with_items:
    - /etc/X11/xorg.conf.d/70-synaptics.conf

- name: Tweak touchpad
  blockinfile:
    path: /etc/X11/xorg.conf.d/70-synaptics.conf
    backup: yes
    block: |
      Section "InputClass"
              Identifier "touchpad"
              MatchDriver "synaptics"
              MatchIsTouchpad "on"
                  Option "TapButton1" "1"
                  Option "TapButton2" "3"
                  Option "TapButton3" "2"
                  Option "HorizTwoFingerScroll" "on"
                  Option "HorizEdgeScroll" "on"
                  Option "PalmDetect" "1"
                  Option "PalmMinWidth" "8"
                  Option "PalmMinZ" "100"
                  Option "VertEdgeScroll" "on"
                  Option "VertTwoFingerScroll" "on"
                  Option "MaxTapTime" "125"
      EndSection

- name: Suspend when lid closed
  lineinfile:
    path: /etc/systemd/logind.conf
    backup: yes
    regexp: "{{item.regexp}}"
    line: "{{item.line}}"
  with_items:
    - { regexp: "^#HandlePowerKey=",    line: "HandlePowerKey=hibernate"}
    - { regexp: "^#HandleLidSwitch=",   line: "HandleLidSwitch=suspend"}
    - { regexp: "^#HoldoffTimeoutSec=", line: "HoldoffTimeoutSec=30s"}
    - { regexp: "^#IdleAction=",        line: "IdleAction=suspend"}
    - { regexp: "^#IdleActionSec=",     line: "IdleActionSec=10min"}

- name: Lock screen before suspending
  template:
    src:   etc/systemd/system/lock-screen-before-suspending.service
    dest:  /etc/systemd/system/lock-screen-before-suspending.service
    owner: root
    group: root
    mode:  0644

- name: Enable lock-screen-before-suspending
  command: 'systemctl enable lock-screen-before-suspending.service'
  args:
    chdir: /etc/systemd/system
